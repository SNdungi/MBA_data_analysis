{% extends "layout.html" %}

{% block content %}
<style>
    /* Custom Sidebar Styles for Accordion */
    .tutorial-sidebar .accordion-item {
        border: none;
        background: transparent;
    }
    .tutorial-sidebar .accordion-button {
        padding: 0.6rem 0.75rem;
        font-size: 0.8rem;
        font-weight: 600;
        background-color: white;
        color: #495057;
        border-radius: 0;
        border-bottom: 1px solid #f0f0f0;
        box-shadow: none;
    }
    .tutorial-sidebar .accordion-button:not(.collapsed) {
        color: var(--fluidcore-teal);
        background-color: #f8f9fa;
        box-shadow: inset 0 -1px 0 rgba(0,0,0,0.125);
    }
    .tutorial-sidebar .accordion-button:focus {
        border-color: rgba(0,0,0,0.1);
        box-shadow: none;
    }
    .tutorial-sidebar .accordion-button::after {
        background-size: 0.8rem; 
        opacity: 0.5;
    }
    .tutorial-sidebar .accordion-body {
        padding: 0;
    }
    
    /* List Item Styles */
    .tutorial-sidebar .list-group-item {
        padding-left: 1.75rem;
        padding-top: 0.4rem;
        padding-bottom: 0.4rem;
        font-size: 0.75rem;
        border: none;
        border-left: 3px solid transparent;
        color: #6c757d;
    }
    .tutorial-sidebar .list-group-item:hover {
        background-color: #f8f9fa;
        color: var(--fluidcore-dark-brown);
    }
    .tutorial-sidebar .list-group-item.active {
        background-color: #eef2f3;
        color: var(--fluidcore-teal);
        border-left-color: var(--fluidcore-orange);
        font-weight: 700;
    }
    
    /* Category Headers */
    .sidebar-category-header {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #adb5bd;
        padding: 1.5rem 0.75rem 0.5rem;
        font-weight: 700;
        border-bottom: 1px solid #f0f0f0;
        margin-bottom: 0.25rem;
    }
    /* Topic Header inside Accordion Body */
    .topic-divider {
        font-size: 0.7rem;
        font-weight: bold;
        color: var(--fluidcore-teal);
        padding: 0.5rem 1rem 0.2rem 1.75rem;
        background-color: #fff;
        border-bottom: 1px dashed #eee;
        margin-top: 0.25rem;
    }
</style>

<div class="container-fluid ">
    <div class="row">
        
        <!-- SIDEBAR -->
        <div class="col-md-3 col-lg-2">
            <div class="card shadow-sm sticky-top border-0" style="top: 4rem; max-height: 85vh; overflow-y: auto;">
                
                <div class="card-header bg-white fw-bold small text-muted text-uppercase border-bottom">
                    <i class="fas fa-graduation-cap me-2"></i>Curriculum
                </div>

                <div class="accordion tutorial-sidebar" id="tutorialAccordion">

                    <!-- LOOP 1: LEVELS (Elementary, Graduate, etc.) -->
                    {% for level in levels %}
                        <div class="sidebar-category-header pt-2">{{ level.title }}</div>

                        <!-- LOOP 2: SECTIONS (Foundations, Regression, etc.) -->
                        {% for section in level.sections %}
                            {% set section_id = "section-" ~ section.id %}
                            <!-- Determine if this section should be open -->
                            {% set is_open = (active_subtopic and active_subtopic.topic.section.id == section.id) %}
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button {% if not is_open %}collapsed{% endif %}" 
                                            type="button" 
                                            data-bs-toggle="collapse" 
                                            data-bs-target="#{{ section_id }}">
                                        {{ section.title }}
                                    </button>
                               </h2>
                                <div id="{{ section_id }}" 
                                     class="accordion-collapse collapse {% if is_open %}show{% endif %}" 
                                     data-bs-parent="#tutorialAccordion">
                                    <div class="accordion-body">
                                        
                                        <!-- LOOP 3: TOPICS (Central Tendency, etc.) -->
                                        {% for topic in section.topics %}
                                            {% if section.topics|length > 1 %}
                                                <div class="topic-divider">{{ topic.title }}</div>
                                            {% endif %}

                                            <div class="list-group list-group-flush">
                                                <!-- LOOP 4: SUBTOPICS (Actual content pages) -->
                                                {% for sub in topic.subtopics %}
                                                    <a href="{{ url_for('tutorials.view', subtopic_id=sub.id) }}" 
                                                       class="list-group-item list-group-item-action {% if active_subtopic and active_subtopic.id == sub.id %}active{% endif %}">
                                                        {{ sub.title }}
                                                    </a>
                                                {% endfor %}
                                            </div>
                                        {% endfor %}
                                        
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% endfor %}

                    {% if not levels %}
                        <div class="p-3 text-center text-muted small">
                            <em>No tutorials loaded.<br>Run <code>flask seed_tutorials</code></em>
                        </div>
                    {% endif %}

                </div>
            </div>
        </div>

        <!-- MAIN CONTENT AREA -->
        <div class="col-md-9 col-lg-10">
            <div class="bg-white p-4 border rounded-2 shadow-sm" style="min-height: 80vh;">
                {% block tutorial_content %}{% endblock %}
            </div>
        </div>
        
    </div>
</div>
{% endblock %}