{% extends "layout.html" %}

{% block content %}
<div class="container-fluid mt-4 mb-5">
    <div class="row">
        
        <!-- SIDEBAR: Compact List Group Style -->
        <div class="col-md-3 col-lg-2">
            <div class="card shadow-sm sticky-top" style="top: 4rem;">
                <div class="card-header bg-white fw-bold small text-muted text-uppercase">
                    <i class="fas fa-code-branch me-2"></i>Encoder Workflow
                </div>
                
                <div class="list-group list-group-flush">
                    <!-- 1. Definitions -->
                    <a href="{{ url_for('encoding.definitions', study_id=study.id) }}" 
                       class="list-group-item list-group-item-action d-flex align-items-center py-2 small {% if request.endpoint == 'encoding.definitions' %}active text-white bg-primary border-primary{% else %}text-dark{% endif %}">
                        <i class="fas fa-book fa-fw me-2 {% if request.endpoint != 'encoding.definitions' %}text-muted{% endif %}"></i> 
                        Definitions
                    </a>
                    
                    <!-- 2. Assign -->
                    <a href="{{ url_for('encoding.assign', study_id=study.id) }}" 
                       class="list-group-item list-group-item-action d-flex align-items-center py-2 small {% if request.endpoint == 'encoding.assign' %}active text-white bg-primary border-primary{% else %}text-dark{% endif %}">
                        <i class="fas fa-sliders-h fa-fw me-2 {% if request.endpoint != 'encoding.assign' %}text-muted{% endif %}"></i> 
                        Assign Columns
                    </a>

                    <!-- 3. Execute (Form styled as a list item) -->
                    <form action="{{ url_for('encoding.run_encoding') }}" method="post" class="m-0 p-0">
                        <input type="hidden" name="study_id" value="{{ study.id }}">
                        <button type="submit" class="list-group-item list-group-item-action d-flex align-items-center py-2 small text-dark border-0 w-100">
                            <i class="fas fa-cogs fa-fw me-2 text-warning"></i> 
                            Generate File
                        </button>
                    </form>
                    
                    <!-- 4. Results (Conditional) -->
                    {% if result_files_exist %}
                    <a href="{{ url_for('encoding.results', study_id=study.id) }}" 
                       class="list-group-item list-group-item-action d-flex align-items-center py-2 small border-top {% if request.endpoint == 'encoding.results' %}active text-white bg-success border-success{% else %}text-success{% endif %}">
                        <i class="fas fa-table fa-fw me-2"></i> 
                        View Encoded Data
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- MAIN CONTENT AREA -->
        <div class="col-md-9 col-lg-10">
            
            <div class="bg-white p-4 border rounded-2 shadow-sm" style="min-height: 80vh;">
                {% block encoder_content %}{% endblock %}
            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block scripts %}
    {% block encoder_scripts %}{% endblock %}
{% endblock %}