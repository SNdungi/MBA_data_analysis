<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ title|default('Data Bootstrapper') }}</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Text&family=JetBrains+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Castoro+Titling&family=Comfortaa:wght@300..700&family=Cormorant+Garamond:ital,wght@0,300..700;1,300..700&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Playfair:ital,opsz,wght@0,5..1200,300..900;1,5..1200,300..900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Caveat+Brush&family=Comic+Relief:wght@400;700&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"> <!-- Place in <head> -->

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Link to your custom stylesheet -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">



</head>
<body>
<!-- TOP NAVBAR -->
    <nav class="navbar navbar-expand-md navbar-dark navbar-custom fixed-top " >
        <div class="container-fluid">
            {% if current_user.is_authenticated %}
                <ul class="navbar-nav mx-auto">
                    

                    <li class="nav-item"><a class="nav-link" href="{{ url_for('tutorials.index') }}">Tutorials</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('file_mgt.list_projects') }}">Projects</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('ops.documentation') }}">Methodology</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('tuit_setup.index') }}">
                        <i class="fas fa-shield-alt fa-fw me-2"></i> 
                    </a>
                    </li>
                </ul>
          

             {% if study %}
            <!-- Inside your Sticky Navbar or Top Bar -->
            <div class="d-flex align-items-center border-start border-end  px-3 py-2">
                <ul class="navbar-nav border-end me-4 pe-3">
                <li class="nav-item"><a class="nav-link" href="{{ url_for('encoding.definitions', study_id=study.id) }}">Data Encoder</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('analysis.dashboard', study_id=study.id) }}">Analysis</a></li>  
                </ul>
                
                <!-- Study Initial Pill -->
                <span class="badge rounded-pill bg-secondary-subtle text-black me-2"> 
                    {{ study.project_code }}
                </span>

                <!-- Connection Status ICON -->
                <span id="connectionStatus" 
                    class="badge bg-secondary text-white me-3" 
                    title="Checking status..." 
                    style="cursor: pointer;">
                    <i class="fas fa-circle-notch fa-spin"></i> Checking...
                </span>

                <!-- Save Status -->
                <span id="saveStatus" class="small me-auto"></span>

                <!-- Manual Actions -->
                <button onclick="SyncManager.syncProjectState()"
                        class="btn btn-sm"
                        title="Save Project State (CSV, JSON, Results) to Local Disk">
                    <i class="fas fa-save text-white fs-5"></i> 
                </button>

            </div>
            {% endif %}
            {% endif %}


            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNav" aria-controls="navbarNav"
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item me-2">
                        <a class="btn btn-outline-light btn-sm px-3 rounded-5"
                        style="background: var(--fluidcore-orange); border: none; color: var(--fluidcore-white);"
                        href="{{ url_for('ops.support') }}"><i class="fas fa-hand-paper me-2"></i> 
                            Request Support
                        </a>
                    </li>
                </ul>

                <ul class="navbar-nav ">
                    {% if current_user.is_authenticated %}
                        <li class="nav-item me-2">
                            <span class="nav-link text-white small">Hi, {{ current_user.username }}</span>
                        </li>
                        <li class="nav-item">
                            <a  href="{{ url_for('auth.logout') }}">
                                <i class="fas fa-door-open text-white pt-2"></i>
                            </a>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('ops.index') }}">
                                <i class="fas fa-home text-white pt-2"></i>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    {% include '_messages.html' %}
    
    <main >      
        
        {% block content %}
        
        {% endblock %}
    </main>
    
    <footer class="footer-custom">
        <div class="container">
            <div class="row g-5">
                
                <!-- COLUMN 1: BRANDING & MISSION -->
                <div class="col-lg-4 col-md-12">
                    <a href="{{ url_for('file_mgt.list_projects') }}" class="text-white text-decoration-none h5 fw-bold mb-3 d-block">
                        TXDataLab
                    </a>
                    <p class="mb-4" style="max-width: 300px;">
                        Advanced data encoding, statistical analysis, and interactive learning tools designed for modern research workflows.
                    </p>
                    <div class="footer-brand-text">
                        <i class="fas fa-code-branch me-2"></i>v2.4.0 (Stable)
                    </div>
                </div>

                <!-- COLUMN 2: PRODUCT LINKS -->
                <div class="col-lg-2 col-6">
                    <div class="footer-heading">Product</div>
                    <ul class="footer-links">
                        <li><a href="{{ url_for('file_mgt.list_projects') }}">Project Manager</a></li>
                        {% if study %}
                            <li><a href="{{ url_for('encoding.definitions', study_id=study.id) }}">Encoding Engine</a></li>
                            <li><a href="{{ url_for('analysis.dashboard', study_id=study.id) }}">Analysis Workbench</a></li>
                        {% else %}
                            <li><span class="text-muted" style="cursor: not-allowed">Encoding Engine</span></li>
                            <li><span class="text-muted" style="cursor: not-allowed">Analysis Workbench</span></li>
                        {% endif %}
                        <li><a href="{{ url_for('ops.index') }}">Legacy Bootstrap</a></li>
                    </ul>
                </div>

                <!-- COLUMN 3: RESOURCES -->
                <div class="col-lg-2 col-6">
                    <div class="footer-heading">Resources</div>
                    <ul class="footer-links">
                        <li><a href="{{ url_for('tutorials.index') }}">Tutorials Hub</a></li>
                        <li><a href="{{ url_for('ops.documentation') }}">Documentation</a></li>
                        <li><a href="#">API Docs</a></li>
                    </ul>
                </div>

                <!-- COLUMN 4: CONNECT & SUBSCRIBE -->
                <div class="col-lg-4 col-md-12">
                    <div class="footer-heading">Stay Connected</div>
                    <p class="small mb-3">Join our community of researchers.</p>
                    
                    <!-- Social Icons -->
                    <div class="social-icons mb-4">
                        <a href="https://github.com/SNdungi/MBA_data_analysis" target="_blank" class="social-icon-btn" title="GitHub">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/stephen-musyoka-3105141b3/" target="_blank" class="social-icon-btn" title="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="https://wa.me/254102965704" target="_blank" class="social-icon-btn" title="WhatsApp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                        <a href="#" class="social-icon-btn" title="Email">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>

                    <!-- Visual Newsletter Input (Non-functional aesthetic) -->
                    <form action="#" onsubmit="event.preventDefault();" class="d-flex gap-2">
                        <input type="email" class="form-control footer-input form-control-sm" placeholder="Enter email for updates...">
                        <button class="btn btn-primary btn-sm px-3" type="button">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
            </div>

            <!-- BOTTOM BAR -->
            <div class="footer-bottom">
                <div>
                    &copy; {{ now().year }} TXDataLab. All Rights Reserved.
                </div>
                <div class="d-none d-md-block">
                    <a href="#" class="text-muted text-decoration-none me-3 hover-white">Privacy Policy</a>
                    <a href="#" class="text-muted text-decoration-none hover-white">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>
{% if study is defined and study %}
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            if (typeof SyncManager !== 'undefined') {
                const csvName = "{{ study.map_filename.replace('.json', '.csv') }}";
                await SyncManager.init({{ study.id }}, csvName);

                // AUTO-SYNC ON RESULTS PAGE
                // If the user just finished a simulation, we want to capture the results immediately.
                if (window.location.href.includes("results") || window.location.href.includes("view_study_results")) {
                    console.log("ðŸ“Š Results page detected. Triggering auto-save to local disk...");
                    setTimeout(() => {
                        SyncManager.syncProjectState();
                    }, 1000); // Small delay to ensure init is done
                }
            }
        });
    </script>
    {% endif %}
    <script src="https://cdn.jsdelivr.net/npm/idb-keyval@6/dist/umd.js"></script>
    <script src="{{ url_for('static', filename='js/storage_strategies.js') }}"></script>
    <script src="{{ url_for('static', filename='js/custom.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/apexcharts.min.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    {% block scripts %}{% endblock %}
</body>
</html>